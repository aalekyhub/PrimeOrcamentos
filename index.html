<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Prime Pro - Gestão Profissional</title>

  <script>
    // DEFESA FINAL: Bloqueia o erro 'ethereum' antes que ele chegue ao UI
    (function () {
      window.process = { env: { API_KEY: '' } };

      // Tenta neutralizar o ethereum se ele tentar ser definido como read-only
      try {
        let ethCache = window.ethereum;
        Object.defineProperty(window, 'ethereum', {
          get: function () { return ethCache; },
          set: function (v) { ethCache = v; },
          configurable: true,
          enumerable: true
        });
      } catch (e) { }

      // Bloqueador de erros global
      window.addEventListener('error', function (event) {
        if (event.message && event.message.toLowerCase().includes('ethereum')) {
          console.warn('Conflito de extensão detectado e bloqueado:', event.message);
          event.stopImmediatePropagation();
          event.preventDefault();
        }
      }, true);

      window.onerror = function (msg) {
        if (msg && msg.toString().toLowerCase().includes('ethereum')) {
          return true; // Impede que o erro mostre a caixa vermelha
        }

        const errDiv = document.getElementById('error-boundary');
        if (errDiv) {
          errDiv.style.display = 'flex';
          const msgEl = document.getElementById('error-msg');
          if (msgEl) msgEl.innerText = msg;
        }
        return false;
      };
    })();

    function resetSystem() {
      if (confirm('Isso apagará todos os dados locais. Continuar?')) {
        localStorage.clear();
        window.location.reload();
      }
    }
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        }
      }
    }
  </script>
  <style>
    /* OVERRIDE GLOBAL DE FONTE */
    * {
      font-family: Helvetica, Arial, sans-serif !important;
    }

    body {
      background-color: #f1f5f9;
      margin: 0;
      height: 100vh;
      overflow: hidden;
    }

    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    #root {
      height: 100%;
    }

    @media print {
      @page {
        margin: 0;
        size: auto;
      }

      body {
        background: white !important;
        overflow: visible !important;
        height: auto !important;
        margin: 0 !important;
        padding: 0 !important;
      }

      /* 
         Comentado para evitar conflitos com o novo sistema de relatórios (ReportPreview)
         que utiliza modais dinâmicos. As regras abaixo escondiam o conteúdo incorretamente.
      
      #root>*:not(.print-container) {
        display: none !important;
      }

      aside,
      main,
      header,
      .print-hide,
      button {
        display: none !important;
      }

      .print-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        margin: 0;
        padding: 0;
        visibility: visible !important;
        display: block !important;
      }
      */
    }

    #error-boundary {
      display: none;
      position: fixed;
      inset: 0;
      background: #fff;
      z-index: 9999;
      padding: 40px;
      text-align: center;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
  </style>

  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@18.2.0",
      "react-dom": "https://esm.sh/react-dom@18.2.0",
      "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
      "react/": "https://esm.sh/react@18.2.0/",
      "react-dom/": "https://esm.sh/react-dom@18.2.0/",
      "lucide-react": "https://esm.sh/lucide-react@0.474.0?external=react",
      "recharts": "https://esm.sh/recharts@2.12.7?external=react,react-dom",
      "@google/genai": "https://esm.sh/@google/genai@1.34.0"
    }
  }
  </script>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="./index.tsx"></script>

  <div id="error-boundary">
    <div
      style="background: #fee2e2; color: #b91c1c; padding: 32px; border-radius: 32px; border: 1px solid #fecaca; max-width: 500px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.1);">
      <h2 style="font-weight: 900; font-size: 24px; margin-bottom: 8px;">Falha Crítica</h2>
      <p id="error-msg" style="font-size: 14px; opacity: 0.8; margin-bottom: 24px; font-family: monospace;"></p>
      <div style="display: flex; gap: 12px; justify-content: center;">
        <button onclick="window.location.reload()"
          style="background: #1e293b; color: white; padding: 12px 24px; border-radius: 16px; border: none; font-weight: bold; cursor: pointer;">Recarregar</button>
        <button onclick="resetSystem()"
          style="background: #ef4444; color: white; padding: 12px 24px; border-radius: 16px; border: none; font-weight: bold; cursor: pointer;">Limpar
          Banco de Dados</button>
      </div>
    </div>
  </div>
</body>

</html>